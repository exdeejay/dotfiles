#!/bin/bash

# Prompt for a Y/N answer
# Usage: readYN <question> [default answer]
# Returns: 'y' or 'n' depending on user input
readYN() {
	if [[ "${2,,}" == "y" ]]; then
		choices="Yn"
	elif [[ "${2,,}" == "n" ]]; then
		choices="yN"
	else
		choices="yn"
	fi
	while true; do
		read -ep "$1 [$choices]: " selection
		[[ "${selection,,}" == "y" || "${selection,,}" == "n" ]] && break
		[[ -z "$selection" ]] && [[ "${2,,}" == "y" || "${2,,}" == "n" ]] && break
	done
	[[ -n "$selection" ]] && echo "${selection,,}" || echo "${2,,}"
}

GIT_USER="$(git config --global user.name)"
while [[ "$GIT_USER" != "exdeejay" ]]; do
	# get stdin from keyboard
	exec < /dev/tty
	echo "ERROR: git user.name is set to \"$GIT_USER\""
	echo "(If you're not exdeejay, run \`rm .githooks/pre-commit\` to make this message go away)"
	if [[ $(readYN "Run \`switchgit\`?" 'y') == 'y' ]]; then
		switchgit
		echo
		GIT_USER="$(git config --global user.name)"
	else
		exit 1
	fi
done
